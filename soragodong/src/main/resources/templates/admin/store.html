<!DOCTYPE html>
<html xmlns:th="thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        :root {
    --xp-blue: #0058e3;
    --xp-light-blue: #245edb;
    --xp-bg: #ece9d8; /* XP íŠ¹ìœ ì˜ ë² ì´ì§€ìƒ‰ ë°°ê²½ */
    --xp-border: #003ca5;
}

body {
    background-color: #3a6ea5; /* ë°°ê²½í™”ë©´ (ê³ ì „ì ì¸ íŒŒë€ ë°°ê²½) */
    font-family: "Tahoma", sans-serif; /* XP ê¸°ë³¸ í°íŠ¸ */
    font-size: 12px;
}

/* ìœˆë„ìš° ì°½ ì „ì²´ êµ¬ì¡° */
.xp-window {
    width: 800px;
    height: 500px;
    background-color: var(--xp-bg);
    border: 3px solid var(--xp-blue);
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
}

/* ì œëª© í‘œì‹œì¤„ */
.title-bar {
    background: linear-gradient(to bottom, #0058e3 0%, #245edb 10%, #0058e3 100%);
    padding: 5px 10px;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
}

/* ì£¼ì†Œì°½ ì˜ì—­ */
.address-bar-container {
    background-color: white;
    border-bottom: 1px solid #999;
    padding: 4px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.address-bar-container input {
    flex-grow: 1;
    border: 1px solid #7f9db9;
    padding: 2px 5px;
}

/* í´ë”ê°€ í‘œì‹œë˜ëŠ” ë©”ì¸ ì˜ì—­ */
.folder-view {
    flex-grow: 1;
    background-color: white;
    margin: 2px;
    border: 2px inset #fff;
    padding: 10px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 20px;
    align-content: start;
    overflow-y: auto;
}

/* ê°œë³„ ì í¬(í´ë”) ì•„ì´í…œ */
.folder-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    cursor: pointer;
    padding: 5px;
    border: 1px solid transparent;
}

.folder-item:hover {
    background-color: rgba(49, 106, 197, 0.1);
    border: 1px solid #316ac5;
}

.folder-icon {
    width: 48px;
    height: 48px;
    background: url('https://img.icons8.com/color/48/folder-invoices.png') no-repeat center;
    margin-bottom: 5px;
}

/* ìš°í´ë¦­ ë©”ë‰´ */
.xp-context-menu {
    position: absolute;
    background: white;
    border: 1px solid #aca899;
    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);
    padding: 2px;
    z-index: 1000;
}

.xp-context-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.xp-context-menu li {
    padding: 5px 20px;
    cursor: default;
}

.xp-context-menu li:hover {
    background-color: #316ac5;
    color: white;
}
        /* ë©”ë‰´ë°” ìŠ¤íƒ€ì¼ */
.menu-bar {
    background-color: var(--xp-bg);
    padding: 2px 10px;
    border-bottom: 1px solid #ccc;
    display: flex;
    gap: 15px;
}

/* ë„êµ¬ ëª¨ìŒ ìŠ¤íƒ€ì¼ */
.toolbar {
    background-color: var(--xp-bg);
    padding: 3px 5px;
    display: flex;
    align-items: center;
    gap: 5px;
    border-bottom: 1px solid #999;
}

.nav-btn {
    background: transparent;
    border: 1px solid transparent;
    display: flex;
    align-items: center;
    padding: 3px 6px;
    cursor: pointer;
}

.nav-btn:hover:not(.disabled) {
    border: 1px solid #316ac5;
    background-color: rgba(49, 106, 197, 0.1);
}

.nav-btn.disabled {
    opacity: 0.5;
    cursor: default;
}

.separator {
    width: 1px;
    height: 25px;
    background-color: #999;
    margin: 0 5px;
}

/* ì£¼ì†Œì°½ ë‚´ë¶€ ì•„ì´ì½˜ ë°°ì¹˜ */
.address-input-wrapper {
    flex-grow: 1;
    display: flex;
    align-items: center;
    border: 1px solid #7f9db9;
    background: white;
    padding: 1px 4px;
}

.address-input-wrapper input {
    border: none;
    width: 100%;
    outline: none;
}

.go-btn {
    border: 1px solid #7f9db9;
    background: var(--xp-bg);
    cursor: pointer;
}
/* ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìƒì„¸ ìŠ¤íƒ€ì¼ */
.xp-context-menu {
    position: absolute;
    background: #fff;
    border: 1px solid #aca899;
    box-shadow: 2px 2px 2px rgba(0,0,0,0.3);
    min-width: 150px;
    z-index: 1000;
}

.menu-item {
    padding: 3px 20px;
    cursor: default;
}

.menu-item:hover:not(.disabled) {
    background-color: #316ac5;
    color: #fff;
}

.menu-item.disabled {
    color: #aca899;
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: auto;
    z-index: 2000;
    padding-bottom: 10px;
}

.modal-body {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.input-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.input-group.inline {
    flex-direction: row;
    align-items: center;
}

.input-group input {
    border: 1px solid #7f9db9;
    padding: 3px;
}

/* XP ìŠ¤íƒ€ì¼ ë²„íŠ¼ */
.xp-button {
    background: #ece9d8;
    border: 1px solid #003ca5;
    padding: 5px 15px;
    box-shadow: inset -1px -1px 1px #808080;
    cursor: pointer;
}

.xp-button:active {
    box-shadow: inset 1px 1px 1px #808080;
}

.modal-footer {
    margin-top: 10px;
    display: flex;
    justify-content: flex-end;
    gap: 5px;
}
/* í•˜ìœ„ ë©”ë‰´ë¥¼ í¬í•¨í•œ ì•„ì´í…œ ì„¤ì • */
.has-submenu {
    position: relative;
}

/* ê¸°ë³¸ì ìœ¼ë¡œ ì„œë¸Œë©”ë‰´ëŠ” ìˆ¨ê¹€ */
.submenu {
    display: none;
    position: absolute;
    left: 100%; /* ë¶€ëª¨ ë©”ë‰´ì˜ ì˜¤ë¥¸ìª½ ëì—ì„œ ì‹œì‘ */
    top: -2px;
    background: white;
    border: 1px solid #aca899;
    box-shadow: 2px 2px 2px rgba(0,0,0,0.3);
    min-width: 150px;
    list-style: none;
    padding: 2px;
}

/* ë¶€ëª¨ ë©”ë‰´ì— í˜¸ë²„ ì‹œ ì„œë¸Œë©”ë‰´ ë…¸ì¶œ */
.has-submenu:hover > .submenu {
    display: block;
}

.arrow {
    font-size: 8px;
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
}

/* ì„œë¸Œë©”ë‰´ ì•„ì´í…œë„ ì¼ë°˜ ë©”ë‰´ ì•„ì´í…œê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ì ìš© */
.submenu li {
    padding: 3px 15px;
    color: black;
}

.submenu li:hover {
    background-color: #316ac5;
    color: white;
}
/* í´ë” ì´ë¦„ í¸ì§‘ ìƒíƒœ */
.folder-name-input {
    width: 90%;
    border: 1px solid #7f9db9;
    background-color: #fff;
    font-size: 11px;
    text-align: center;
    outline: none;
    margin-top: 2px;
}

/* ì´ë¦„ì´ ì„ íƒë˜ì—ˆì„ ë•Œì˜ XP ìŠ¤íƒ€ì¼ ë¸”ë£¨ ë¸”ë¡ */
.folder-item.selected .folder-name {
    background-color: #316ac5;
    color: white;
}
/* ìƒí’ˆ(íŒŒì¼) ì•„ì´ì½˜ */
.product-file .product-icon {
    width: 48px;
    height: 48px;
    background: url('https://img.icons8.com/color/48/box--v1.png') no-repeat center;
    margin-bottom: 5px;
}

/* ìƒí’ˆì˜ ê°€ê²© ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ìŠ¤íƒ€ì¼ */
.product-price {
    font-size: 11px;
    color: #555;
}

/* XP ìŠ¤íƒ€ì¼ ëª¨ë‹¬ ë‚´ë¶€ ìƒí’ˆ ì…ë ¥ í¼ */
.modal-body .input-row {
    display: flex;
    gap: 10px;
    margin-bottom: 8px;
}

.modal-body .input-row input {
    flex: 1;
}

/* CSSì— ì´ ë¶€ë¶„ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì„¸ìš” */
.store-icon {
    width: 48px;
    height: 48px;
    /* ê³ ì „ì ì¸ ìƒì  ì•„ì´ì½˜ URL (Icons8 ì œê³µ) */
    background-image: url('https://img.icons8.com/color/48/shop.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    margin-bottom: 5px;
}

/* ì´ë¯¸ì§€ê°€ ë“±ë¡ëœ ì í¬ì˜ ì‚¬ì§„ ìŠ¤íƒ€ì¼ */
.store-thumb {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border: 1px solid #ccc;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}
    </style>
</head>
<body>
<div class="xp-window">
    <div class="title-bar">
        <div class="title-text">íŒŒì¼ íƒìƒ‰ê¸° - ì í¬ ê´€ë¦¬ì</div>
        <div class="title-buttons">ï¼ â–¡ Ã—</div>
    </div>

    <div class="menu-bar">
        <span>íŒŒì¼(F)</span><span>í¸ì§‘(E)</span><span>ë³´ê¸°(V)</span><span>ì¦ê²¨ì°¾ê¸°(A)</span><span>ë„êµ¬(T)</span><span>ë„ì›€ë§(H)</span>
    </div>

    <div class="toolbar">
        <button id="btn-back" class="nav-btn" onclick="navigateUp()" title="ë’¤ë¡œ ê°€ê¸°">
            <span class="icon-back"></span> ë’¤ë¡œ
        </button>
        <button class="nav-btn disabled"><span class="icon-forward"></span></button>
        <button id="btn-up" class="nav-btn" onclick="navigateUp()" title="ìƒìœ„ í´ë”ë¡œ">
            <span class="icon-up"></span>
        </button>
        <div class="separator"></div>
        <button class="nav-btn"><span class="icon-search"></span> ê²€ìƒ‰</button>
        <button class="nav-btn"><span class="icon-folders"></span> í´ë”</button>
    </div>

    <div class="address-bar-container">
        <span>ì£¼ì†Œ(D)</span>
        <div class="address-input-wrapper">
            <img src="folder-small-icon.png" class="address-icon">
            <input type="text" id="address-input"
                   th:value="${currentPath.replace(' ', '\')}"
                   onkeypress="if(event.keyCode==13) navigateTo(this.value)">
        </div>
        <button id="btn-go" class="go-btn" onclick="navigateTo(document.getElementById('address-input').value)">ì´ë™</button>
    </div>

    <div id="folder-container" class="folder-view">
        <th:block th:if="${viewMode == 'STORE'}">
        <div th:each="folder : ${subFolders}" class="folder-item"
             th:onclick="|location.href='@{/admin/store(path=${currentPath} + ' ' + ${folder})}'|">
            <div class="folder-icon"></div>
            <div class="folder-name" th:text="${folder}">>êµ¬/ë™</div>
        </div>

        <div th:each="store : ${currentStores}" class="folder-item store-file"
             th:data-idx="${store.storeIdx}"
             th:data-name="${store.storeName}"
             th:onclick="enterStore([[${store.storeIdx}]], [[${store.storeName}]])"
             th:oncontextmenu="|setTarget(this); return false;|"
             th:title="|ì˜ì—…ì‹œê°„: ${store.storeOpenTime} ~ ${store.storeCloseTime}|">
            <div class="store-icon-container">
                <img th:if="${store.storePictureIdx != null}"
                     th:src="@{/images(filename=${store.storePictureIdx})}"
                     style="width:48px; height:48px; object-fit:cover; border-radius:3px;">
                <div class="store-icon" th:style="${store.storePictureIdx == null ? 'display:block;' : 'display:none;'}"></div>
            </div>
            <div class="folder-name" th:text="${store.storeName}">ì í¬ëª…</div>
        </div>
        </th:block>
        <th:block th:if="${viewMode == 'PRODUCT'}">
            <div th:each="product : ${productList}" class="folder-item product-file"
                 th:oncontextmenu="|setTargetProduct(this); return false;|">
                <div class="icon-wrapper">
                    <img th:if="${product.productPictureIdx != null}" th:src="@{/images(filename=${product.productPictureIdx})}" class="product-thumb">
                    <div class="product-icon" th:style="${product.productPictureIdx == null ? 'display:block;' : 'display:none;'}"></div>
                </div>
                <div class="folder-name" th:text="${product.productName}">ìƒí’ˆëª…</div>
                <div class="product-price" th:text="${#numbers.formatInteger(product.price, 0, 'COMMA') + 'ì›'}">ê°€ê²©</div>
            </div>
        </th:block>
    </div>
</div>
<div id="context-menu" class="xp-context-menu" style="display:none;">
    <ul>
        <li class="menu-item disabled">ë³´ê¸°(V)</li>

        <li class="menu-item" onclick="location.reload()">ìƒˆë¡œ ê³ ì¹¨(E)</li>
        <li class="menu-item" onclick="handleRename()">ì´ë¦„ ë°”ê¾¸ê¸°(M)</li>
        <li class="menu-item" onclick="handleDelete()">ì‚­ì œ(D)</li>
        <li class="menu-item" onclick="handleEdit()">ì†ì„±/ìˆ˜ì •(R)</li>
        <hr>
        <li class="menu-item has-submenu">
            ìƒˆë¡œ ë§Œë“¤ê¸°(W) <span class="arrow">â–¶</span>
            <ul class="submenu">
                <li id="menu-new-address" onclick="addNewAddress()">ğŸ“ ì£¼ì†Œ ì¶”ê°€(A)</li>
                <li id="menu-new-store" onclick="openRegisterModal()">ğŸª ìƒˆ ì í¬ ë“±ë¡(S)</li>
                <li id="menu-new-product" onclick="openProductModal()" style="display:none;">ğŸ“¦ ìƒˆ ìƒí’ˆ ë“±ë¡(P)</li>
            </ul>
        </li>
        <hr>
        <li class="menu-item disabled">ì†ì„±(R)</li>
    </ul>
</div>
<!--ë©”ë‰´-->
<div id="register-modal" class="xp-window modal" style="display:none;">
    <div class="title-bar">
        <div class="title-text">ìƒˆ ì í¬ ë“±ë¡ - StoreDto</div>
        <div class="title-buttons"><span onclick="closeModal()" style="cursor:pointer;">Ã—</span></div>
    </div>
    <div class="modal-body">
        <div class="input-group">
            <label>ì í¬ ì•„ì´ì½˜/ì‚¬ì§„(P):</label>
            <div class="xp-file-input">
                <input type="file" id="reg-storeImage" accept="image/*" onchange="previewImage(this)">
            </div>
            <div id="image-preview-container" style="margin-top:5px; display:none;">
                <img id="image-preview" src="" style="width:48px; height:48px; border:1px inset #fff;">
            </div>
        </div>
        <div class="input-group">
            <label>ì í¬ëª…:</label>
            <input type="text" id="reg-storeName" placeholder="ì˜ˆ: ì†Œë¼ê³ ë™ ê°•ë‚¨ì ">
        </div>
        <div style="border: 1px dashed #999; padding: 10px; margin-top: 10px; background: #f0f0f0;">
            <p style="font-weight: bold; margin-bottom: 5px;">ğŸ”‘ ì ì£¼ ê³„ì • ìƒì„±</p>
            <div class="input-group">
                <label>ì ì£¼ ID:</label>
                <input type="text" id="reg-ownerId" placeholder="ì•„ì´ë”” ì…ë ¥">
            </div>
            <div class="input-group">
                <label>ì„ì‹œ PW:</label>
                <input type="password" id="reg-ownerPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            </div>
        </div>
        <div class="input-group">
            <label>ì£¼ì†Œ:</label>
            <input type="text" id="reg-storeAddress" readonly>
        </div>
        <div class="input-group inline">
            <label>ì˜ì—… ì‹œì‘:</label>
            <input type="time" id="reg-storeOpenTime">
            <label>ì˜ì—… ì¢…ë£Œ:</label>
            <input type="time" id="reg-storeCloseTime">
        </div>
        <div class="input-group">
            <label>ì´ë²¤íŠ¸ ë‚´ìš©(E):</label>
            <input type="text" id="reg-eventNote" placeholder="ì˜ˆ: ì•„ë©”ë¦¬ì¹´ë…¸ 1+1 í–‰ì‚¬ ì¤‘!">
        </div>
        <div class="input-group inline">
            <label>ì´ë²¤íŠ¸ ì‹œì‘:</label>
            <input type="time" id="reg-eventStartTime">
            <label>ì´ë²¤íŠ¸ ì¢…ë£Œ:</label>
            <input type="time" id="reg-eventEndTime">
        </div>
        <div class="modal-footer">
            <button class="xp-button" onclick="registerStore()">í™•ì¸</button>
            <button class="xp-button" onclick="closeModal()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>
<div id="product-modal" class="xp-window modal" style="display:none;">
    <div class="title-bar">
        <div class="title-text">ìƒˆ ìƒí’ˆ ë“±ë¡ - StoreProductDto</div>
        <div class="title-buttons"><span onclick="closeProductModal()" style="cursor:pointer;">Ã—</span></div>
    </div>
    <div class="modal-body">
        <div class="input-group">
            <label>ìƒí’ˆ ì¹´í…Œê³ ë¦¬:</label>
            <input type="text" id="prod-category" placeholder="ì˜ˆ: ìŒë£Œ, ë² ì´ì»¤ë¦¬">
        </div>
        <div class="input-group">
            <label>ìƒí’ˆëª…:</label>
            <input type="text" id="prod-productName">
        </div>
        <div class="input-row">
            <div>
                <label>ê°€ê²©(ì›):</label>
                <input type="number" id="prod-price" value="0" style="width: 80px;">
            </div>
            <div>
                <label>í• ì¸ ê°€ê²©(ì›):</label>
                <input type="number" id="prod-eventPrice" value="0" style="width: 80px;">
            </div>
            <div>
                <label>ìˆ˜ëŸ‰(ê°œ):</label>
                <input type="number" id="prod-productQuantity" value="100" style="width: 60px;">
            </div>
        </div>
        <div class="modal-footer">
            <button class="xp-button" onclick="registerProduct()">í™•ì¸</button>
            <button class="xp-button" onclick="closeProductModal()">ì·¨ì†Œ</button>
        </div>
    </div>
</div>
<!-- í•˜ìœ„ ë©”ë‰´-->

<script th:inline="javascript">
    // 1. ì„œë²„ì—ì„œ ë„˜ê²¨ì¤€ ê²½ë¡œ ë¬¸ìì—´ (ì˜ˆ: "ì „ì²´ì§€ì—­ ì„œìš¸ ë™ì‘êµ¬ ì‚¬ë‹¹2í˜¸ì ")
    const currentPathStr = [[${currentPath}]];



    // 2. ì´ ë¬¸ìì—´ì„ ê³µë°± ê¸°ì¤€ìœ¼ë¡œ ì˜ë¼ì„œ ë°°ì—´ë¡œ ë§Œë“­ë‹ˆë‹¤.
    // ["ì „ì²´ì§€ì—­", "ì„œìš¸", "ë™ì‘êµ¬", "ì‚¬ë‹¹2í˜¸ì "]
    let currentPath = currentPathStr.trim().split(" ");

    // 3. ì£¼ì†Œì°½ì—ë„ ì—­ìŠ¬ë˜ì‹œ(\)ë¥¼ ë¶™ì—¬ì„œ ì˜ˆì˜ê²Œ ì¶œë ¥í•©ë‹ˆë‹¤.
    // address-inputì˜ valueê°€ "ì „ì²´ì§€ì—­\ì„œìš¸\ë™ì‘êµ¬\ì‚¬ë‹¹2í˜¸ì "ì´ ë©ë‹ˆë‹¤.
    document.getElementById('address-input').value = currentPath.join('\\');

    // 4. ì´ì œ ë’¤ë¡œê°€ê¸°(btnBack)ë¥¼ ëˆ„ë¥´ë©´?
    // currentPath.pop()ì´ ì‹¤í–‰ë˜ë©´ì„œ ["ì „ì²´ì§€ì—­", "ì„œìš¸", "ë™ì‘êµ¬"]ê°€ ë˜ê³ ,
    // ì •ìƒì ìœ¼ë¡œ í•œ ë‹¨ê³„ ìœ„ë¡œ ì˜¬ë¼ê°€ê²Œ ë©ë‹ˆë‹¤!

    const addressInput = document.getElementById('address-input');
    const btnBack = document.getElementById('btn-back');

    // ì£¼ì†Œ ì—…ë°ì´íŠ¸ ë° í™”ë©´ ê°±ì‹  í•¨ìˆ˜
    function updateView(pathArray) {
        currentPath = pathArray;
        const pathString = currentPath.join('\\');
        addressInput.value = pathString;

        // ì—¬ê¸°ì„œ í•´ë‹¹ ì£¼ì†Œì˜ í´ë” ëª©ë¡ì„ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ í•„í„°ë§í•˜ì—¬ ì¶œë ¥í•˜ëŠ” ë¡œì§ ì‹¤í–‰
        console.log(`${pathString}ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...`);
    }

    // ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ (ìƒìœ„ ì£¼ì†Œë¡œ ì´ë™)
    btnBack.addEventListener('click', () => {
        if (currentPath.length > 1) {
            currentPath.pop(); // ë§ˆì§€ë§‰ ê²½ë¡œ ì œê±°
            updateView(currentPath);
        }
    });

    // ì£¼ì†Œì°½ ì—”í„° ê²€ìƒ‰ (ì´ë™)
    addressInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const newPath = addressInput.value.split('\\').filter(p => p !== "");
            updateView(newPath);
        }
    });

    // ì´ë™ ë²„íŠ¼ í´ë¦­
    document.getElementById('btn-go').addEventListener('click', () => {
        const newPath = addressInput.value.split('\\').filter(p => p !== "");
        updateView(newPath);
    });

    const folderView = document.getElementById('folder-container');
    const contextMenu = document.getElementById('context-menu');
    const registerModal = document.getElementById('register-modal');
    const viewMode = [[${viewMode}]];


    // 1. ìš°í´ë¦­ ì‹œ ë©”ë‰´ ë³´ì´ê¸°
    folderView.addEventListener('contextmenu', (e) => {
        e.preventDefault();

        // 1. Thymeleafì—ì„œ ë„˜ê²¨ì¤€ viewMode ê°’ì„ JS ë³€ìˆ˜ë¡œ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        // ë§Œì•½ ì¸ë¼ì¸ ëª¨ë“œê°€ ì•ˆëœë‹¤ë©´ HTML ì–´ë”˜ê°€ì— hidden inputìœ¼ë¡œ ì €ì¥í•´ë‘ê³  ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.


        // 2. ë©”ë‰´ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ ê°€ì ¸ì˜¤ê¸°
        const menuStore = document.getElementById('menu-new-store');
        const menuProduct = document.getElementById('menu-new-product');

        if (viewMode === 'PRODUCT') {
            if(menuStore) menuStore.style.display = 'none';
            if(menuProduct) menuProduct.style.display = 'block';
        } else {
            if(menuStore) menuStore.style.display = 'block';
            if(menuProduct) menuProduct.style.display = 'none';
        }

        // 4. ë©”ë‰´ ë„ìš°ê¸°
        contextMenu.style.display = 'block';
        contextMenu.style.left = `${e.pageX}px`;
        contextMenu.style.top = `${e.pageY}px`;
    });

    // 2. ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ ë©”ë‰´ ìˆ¨ê¸°ê¸°
    document.addEventListener('click', () => {
        contextMenu.style.display = 'none';
    });

    // 3. ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
    function openRegisterModal() {
        // í˜„ì¬ ì£¼ì†Œì°½ì˜ ê°’ì„ ë“±ë¡ í¼ì˜ ì£¼ì†Œì¹¸ì— ìë™ ì…ë ¥
        document.getElementById('reg-storeAddress').value = document.getElementById('address-input').value;
        registerModal.style.display = 'block';
    }

    function closeModal() {
        registerModal.style.display = 'none';
    }
    // 4.ì£¼ì†Œ ì¶”ê°€ (ë‹¨ìˆœ í•˜ìœ„ ì§€ì—­ í´ë” ìƒì„±)
    function addNewAddress() {
        const container = document.getElementById('folder-container');

        // 1. ì„ì‹œ í´ë” ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
        const newFolder = document.createElement('div');
        newFolder.className = 'folder-item';

        // 2. XP ìŠ¤íƒ€ì¼: ì•„ì´ì½˜ + ì…ë ¥ì°½ êµ¬ì„±
        newFolder.innerHTML = `
            <div class="folder-icon"></div>
            <input type="text" class="folder-name-input" value="ìƒˆ í´ë”">
        `;

        container.appendChild(newFolder);

        // 3. ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ë° í…ìŠ¤íŠ¸ ì „ì²´ ì„ íƒ (XPì˜ ë°”ë¡œ ê·¸ ëŠë‚Œ!)
        const input = newFolder.querySelector('.folder-name-input');
        input.focus();
        input.select();

        // 4. ì…ë ¥ ì™„ë£Œ ì²˜ë¦¬ (ì—”í„° í‚¤ ë˜ëŠ” í¬ì»¤ìŠ¤ë¥¼ ìƒì—ˆì„ ë•Œ)
        const finishEditing = () => {
            const folderName = input.value.trim() || "ìƒˆ í´ë”";
            const nameDiv = document.createElement('div');
            nameDiv.className = 'folder-name';
            nameDiv.innerText = folderName;

            // ì…ë ¥ì°½ì„ ì¼ë°˜ í…ìŠ¤íŠ¸ divë¡œ êµì²´
            newFolder.replaceChild(nameDiv, input);

            // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²° (í•˜ìœ„ ì£¼ì†Œë¡œ ì§„ì…)
            newFolder.ondblclick = () => {
                const currentAddr = document.getElementById('address-input').value;
                updateView([...currentAddr.split('\\'), folderName]);
                container.innerHTML = ''; // ì§„ì… ì‹œ ë‚´ë¶€ ë¹„ìš°ê¸°
            };
        };

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') finishEditing();
        });

        input.addEventListener('blur', finishEditing);
    }
    function registerStore() {
        const name = document.getElementById('reg-storeName').value;

        // 1. ìœ íš¨ì„± ê²€ì‚¬
        if (!name) {
            alert("ì í¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        // 2. ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° ì¤€ë¹„ (í™”ë©´ì— ê·¸ë¦¬ëŠ” ëŒ€ì‹  ì„œë²„ì— ìœë‹¤!)
        const formData = new FormData();

        // í˜„ì¬ ì£¼ì†Œì°½ì˜ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ DB ì£¼ì†Œ ìƒì„± (C:\ì „ì²´ì§€ì—­\ì„œìš¸ -> ì „ì²´ì§€ì—­ ì„œìš¸)
        let rawAddress = document.getElementById('address-input').value;
        let dbAddress = rawAddress.replace("ì „ì²´ì§€ì—­", "").replaceAll("\\", " ").trim();

        formData.append('storeName', name);
        formData.append('storeAddress', dbAddress);
<!--  ì¶”ê°€í•œê±°      -->
        formData.append('ownerId', document.getElementById('reg-ownerId').value);
        formData.append('ownerPw', document.getElementById('reg-ownerPw').value);
<!--        formData.append('storeOpenTime', document.getElementById('reg-storeOpenTime').value);-->
<!--        formData.append('storeCloseTime', document.getElementById('reg-storeCloseTime').value);-->
<!--        formData.append('eventNote', document.getElementById('reg-eventNote').value);-->
<!--        formData.append('eventStartTime', document.getElementById('reg-eventStartTime').value);-->
<!--        formData.append('eventEndTime', document.getElementById('reg-eventEndTime').value);-->



        // 3. ì„œë²„ ì „ì†¡
        fetch('/admin/api/store', {
            method: 'POST',
            body: formData
        })
        .then(res => {
            if (res.ok) {
                alert("ì„œë²„ì— ì í¬ ë“±ë¡ ì„±ê³µ!");
                // 4. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì„œë²„ê°€ DBì—ì„œ ìƒˆ ì í¬ë¥¼ ì½ì–´ì™€ì„œ í™”ë©´ì— ê·¸ë ¤ì¤ë‹ˆë‹¤.
                location.reload();
            } else {
                alert("ì„œë²„ ë“±ë¡ ì‹¤íŒ¨!");
            }
        });
    }

    // ìƒìœ„ í´ë”ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
    function navigateUp() {
    // ìƒë‹¨ì—ì„œ ì´ë¯¸ ì •ì˜ëœ currentPath ë°°ì—´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    if (currentPath.length > 1) {
        // 1. ë§ˆì§€ë§‰ ê²½ë¡œ í•˜ë‚˜ ì œê±°
        currentPath.pop();

        // 2. ë‚¨ì€ ê²½ë¡œë“¤ì„ ê³µë°±ìœ¼ë¡œ í•©ì³ì„œ ì„œë²„ì— ìš”ì²­
        const parentPath = currentPath.join(" ");
        location.href = "/admin/store?path=" + encodeURIComponent(parentPath);
    } else {
        // ë” ì´ìƒ ì˜¬ë¼ê°ˆ ê³³ì´ ì—†ìœ¼ë©´ ì „ì²´ì§€ì—­ìœ¼ë¡œ ì´ë™
        location.href = "/admin/store?path=ì „ì²´ì§€ì—­";
    }
}
        // ì£¼ì†Œ ì—…ë°ì´íŠ¸ ë° ì„œë²„ ì´ë™ í•¨ìˆ˜

function navigateTo(pathString) {
    if (!pathString) return;

    // ì£¼ì†Œì°½ì˜ \ë¥¼ ê³µë°±ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡
    let serverPath = pathString
        .replace("C:\\", "")
        .replaceAll("\\", " ")
        .trim();

    location.href = '/admin/store?path=' + encodeURIComponent(serverPath);
}




    // ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('image-preview').src = e.target.result;
                document.getElementById('image-preview-container').style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    let targetStore = null;

    function setTarget(el) {
        // ìš°í´ë¦­í•œ ìš”ì†Œì˜ ì •ë³´ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        console.log("ìš°í´ë¦­ ëŒ€ìƒ ì„¤ì •:", el.getAttribute('data-name'));
        targetStore = {
            idx: el.getAttribute('data-idx'),
            name: el.getAttribute('data-name'),
            element: el
        };
    }

    function handleDelete() {
        if (!targetStore) return;

        if (confirm(`'${targetStore.name}' ì í¬ë¥¼ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            fetch(`/admin/api/store/${targetStore.idx}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    location.reload();
                }
            });
        }
    }

    function handleRename() {
        if (!targetStore) return;

        const nameDiv = targetStore.element.querySelector('.folder-name');
        const oldName = nameDiv.innerText;

        // ì…ë ¥ì°½ ìƒì„±
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'folder-name-input';
        input.value = oldName;

        targetStore.element.replaceChild(input, nameDiv);
        input.focus();
        input.select();

        const updateName = () => {
            const newName = input.value.trim();
            if (newName && newName !== oldName) {
                // ì„œë²„ì— ì´ë¦„ ìˆ˜ì • ìš”ì²­ (StoreDtoì˜ storeName ì—…ë°ì´íŠ¸)
                fetch(`/admin/api/store/rename`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        storeIdx: targetStore.idx,
                        storeName: newName
                    })
                }).then(res => { if(res.ok) location.reload(); });
            } else {
                targetStore.element.replaceChild(nameDiv, input);
            }
        };

        input.onkeydown = (e) => { if(e.key === 'Enter') updateName(); };
        input.onblur = updateName;
    }
    // ì í¬ ë”ë¸” í´ë¦­ ì‹œ í˜¸ì¶œ (Thymeleafì—ì„œ storeIdxë¥¼ ì¸ìë¡œ ë„˜ê¹€)
    function enterStore(storeIdx, storeName) {
        // 1. ì£¼ì†Œì°½ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì£¼ì†Œ ë’¤ì— ì í¬ëª… ì¶”ê°€)
        const currentAddr = document.getElementById('address-input').value;

        // 2. ì£¼ì†Œì°½ì— 'C:\'ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ì œê±°í•˜ê³ , ëª¨ë“  '\'ë¥¼ ' '(ê³µë°±)ìœ¼ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
        let cleanAddr = currentAddr
        .replace("C:\\", "")
        .replaceAll("\\", " ")
        .trim();

        const nextPath = cleanAddr + " " + storeName;

        // 2. ìƒí’ˆ í˜ì´ì§€ë¡œ ì´ë™ (ì í¬ ê³ ìœ  ë²ˆí˜¸ì™€ í•¨ê»˜)
        location.href = `/admin/store?storeIdx=${storeIdx}&path=${encodeURIComponent(nextPath)}`;
    }
    function registerProduct() {
        // 1. í˜„ì¬ URL ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì—ì„œ storeIdxë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const urlParams = new URLSearchParams(window.location.search);
        const storeIdx = urlParams.get('storeIdx');

        if (!storeIdx) {
            alert("ì í¬ ì •ë³´(storeIdx)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        const productData = {
            storeIdx: parseInt(storeIdx),
            category: document.getElementById('prod-category').value,
            productName: document.getElementById('prod-productName').value,
            price: parseInt(document.getElementById('prod-price').value),
            eventPrice: parseInt(document.getElementById('prod-eventPrice').value) || 0,

            productQuantity: parseInt(document.getElementById('prod-productQuantity').value),

        };

        if (!productData.productName) {
            alert("ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        fetch('/admin/api/product', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(productData)
        })
        .then(res => {
            if(res.ok) {
                alert("ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            }   else {
                alert("ìƒí’ˆ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        }).catch(err => {
            console.error("ì—ëŸ¬ ë°œìƒ:", err);
            alert("ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }
    function openProductModal() {
        // ìƒí’ˆ ë“±ë¡ ëª¨ë‹¬ì„ í‘œì‹œ
        const productModal = document.getElementById('product-modal');
        if (productModal) {
            productModal.style.display = 'block';
        }
    }
    function closeProductModal() {
        document.getElementById('product-modal').style.display = 'none';
    }
    function handleEdit() {

        if (!targetStore){
            console.error("ìˆ˜ì •í•  ëŒ€ìƒ(targetStore)ì´ ì—†ìŠµë‹ˆë‹¤!");
            return;
            }
            console.log("ìˆ˜ì • ëŒ€ìƒ IDX:", targetStore.idx);
        // 1. ì„œë²„ì—ì„œ í•´ë‹¹ ì í¬ì˜ ìƒì„¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        fetch(`/admin/api/store/${targetStore.idx}`)
            .then(res => res.json())
            .then(data => {
            console.log("ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°:", data);
                // 2. ëª¨ë‹¬ì°½ì˜ ì…ë ¥ì¹¸ì— ê¸°ì¡´ ë°ì´í„°ë¥¼ ì±„ì›ë‹ˆë‹¤.
                document.getElementById('reg-storeName').value = data.storeName;
                document.getElementById('reg-storeAddress').value = data.storeAddress;
                document.getElementById('reg-storeOpenTime').value = data.storeOpenTime;
                document.getElementById('reg-storeCloseTime').value = data.storeCloseTime;
                document.getElementById('reg-eventNote').value = data.eventNote || "";
                document.getElementById('reg-eventStartTime').value = data.eventStartTime || "";
                document.getElementById('reg-eventEndTime').value = data.eventEndTime || "";
                console.log("ê°’ì„ ê°€ì ¸ì˜´");
                // 3. ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì²˜ë¦¬ (ê¸°ì¡´ ì‚¬ì§„ì´ ìˆë‹¤ë©´)
                if(data.storePictureIdx) {
                    document.getElementById('image-preview').src = `/images?filename=${data.storePictureIdx}`;
                    document.getElementById('image-preview-container').style.display = 'block';
                }

                // 4. ëª¨ë‹¬ ì œëª© ë³€ê²½ ë° í™•ì¸ ë²„íŠ¼ì˜ í•¨ìˆ˜ë¥¼ ìˆ˜ì •ìš©ìœ¼ë¡œ ë³€ê²½
                document.querySelector('#register-modal .title-text').innerText = "ì í¬ ì†ì„± ìˆ˜ì • - " + data.storeName;
                const confirmBtn = document.querySelector('#register-modal .xp-button[onclick="registerStore()"]');
                confirmBtn.setAttribute('onclick', `updateStore(${data.storeIdx})`);
                console.log("ëª¨ë‹¬ ì—´ê¸° ì „");
                // 5. ëª¨ë‹¬ ì—´ê¸°
                document.getElementById('register-modal').style.display = 'block';
            });
    }
    function updateStore(storeIdx) {
        const formData = new FormData();

        // ìˆ˜ì • ë°ì´í„° ìˆ˜ì§‘
        formData.append('storeName', document.getElementById('reg-storeName').value);
        formData.append('storeAddress', document.getElementById('reg-storeAddress').value); // ìˆ˜ì • ì‹œì—” ì´ë¯¸ ê°€ê³µëœ ì£¼ì†Œì¼ ìˆ˜ ìˆìŒ
        formData.append('storeOpenTime', document.getElementById('reg-storeOpenTime').value);
        formData.append('storeCloseTime', document.getElementById('reg-storeCloseTime').value);
        formData.append('eventNote', document.getElementById('reg-eventNote').value);
        formData.append('eventStartTime', document.getElementById('reg-eventStartTime').value);
        formData.append('eventEndTime', document.getElementById('reg-eventEndTime').value);

        const imageFile = document.getElementById('reg-storeImage').files[0];
        if (imageFile) formData.append('uploadFile', imageFile);

        // ì„œë²„ ì „ì†¡ (PATCH)
        fetch(`/admin/api/store/${storeIdx}`, {
            method: 'PATCH',
            body: formData
        })
        .then(res => {
            if (res.ok) {
                alert("ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } else {
                alert("ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        })
        .catch(err => console.error("ì—ëŸ¬:", err));
    }
</script>
</body>
</html>